{% extends "base.html" %}
{% load humanize %}
{% block content %}
<style>
.tutorial { border: 1px solid black; padding: 1em; }
.victory { text-align: center; font-weight: bold; }
</style>

<h1>Puzzles</h1>

{% if hunt_is_prereleased %}
<h4 style="text-align: center">
    You are a pre-release testsolver, so you may be seeing puzzles that are
    locked for the general public. Please be careful!
</h4>
{% endif %}

{% for round in unlocks.rounds %}
{% if round.puzzles %}
{% if forloop.first %}
<h4>Round 1</h4>

<p>Insert story here!</p>

{% if team and not solved_any %}
<p class="tutorial">If this is your first puzzlehunt, we encourage you to check out all the unlocked puzzles! You can solve them in any order. The text in this box is not part of any puzzle, and will disappear after your first solve.</p>
{% endif %}

{% else %}
{# For more than 2 rounds, use forloop.counter to decide what to show? #}
<h4>Round 2: Attack of the Clones</h4>

<p>Insert story here!</p>
{% endif %}

<table class="gph-list-table">
<tr>
    <th>Puzzle</th>
    <th>Solved?</th>
    <th>âœ¨ Value</th>
    <th>Solves / Guesses</th>
    <th>
        {% if unlocks.puzzles and unlocks.puzzles.0.full_stats %}
        Solution
        {% elif unlocks.puzzles and 'hints' in unlocks.puzzles.0 %}
        Hints
        {% endif %}
    </th>
    <th>
    </th>
</tr>
{% for data in round.puzzles %}
<tr>
    <td><a href="{% url 'puzzle' data.puzzle.slug %}">{{ data.puzzle.name }}</a></td>
    <td>
        {% if 'answer' in data %}
            Answer: <b class="solved-title-answer">{{ data.answer }}</b>
        {% endif %}
    </td>
    <td>
        {{ data.puzzle.reward }}
    </td>
    <td>
        {% with data.solve_stats as stats %}
        {% if data.full_stats %}
        <a href="{% url 'stats' data.puzzle.slug %}">
        {% endif %}
        {{ stats.correct }} / {{ stats.guesses }}
        {% if data.full_stats %}
        ({{ stats.teams }} team{{ stats.teams|pluralize }})
        </a>
        {% endif %}
        {% endwith %}
    </td>
    <td>
        {% if data.full_stats %}
        <a href="{% url 'solution' data.puzzle.slug %}">
            <b>Solution</b>
        </a>
        {% elif 'hints' in data %}
        <a href="{% url 'hints' data.puzzle.slug %}">
            Hints: <b>{{ data.hints }}</b>
        </a>
        {% endif %}
    </td>
    <td>
        {% if is_superuser %}
        <a href="{% url 'survey' data.puzzle.slug %}">
        {% endif %}
        {% if 'survey_stats' in data %}
        {% for stat in data.survey_stats %}
        <b>{{ stat.average|floatformat:2 }} <small>/ {{ stat.max_rating }}</small></b> {{ stat.adjective }}
        {% if not forloop.last %}|{% endif %}
        {% endfor %}
        {% endif %}
        {% if is_superuser %}
        </a>
        {% endif %}
    </td>
</tr>
{% endfor %}

{% if round.next %}
<tr>
	<td class="preview-next fade1" colspan="6">ðŸ”’ <span>{% if round.next.is_meta %}Metapuzzle{% else %}Puzzle{% endif %} unlocks at âœ¨{{ round.next.deep }}</span> ðŸ”’</td>
</tr>
{% if round.second_next %}
<tr>
	<td class="preview-next fade2" colspan="6">ðŸ”’ <span>{% if round.second_next.is_meta %}Metapuzzle{% else %}Puzzle{% endif %} unlocks at âœ¨{{ round.second_next.deep }}</span> ðŸ”’</td>
</tr>
{% endif %}
{% elif not round.meta_solved %}
<tr>
    <td class="preview-next" colspan="6">Solve the metapuzzle to proceed!</td>
</tr>
{% endif %}
</table>
{% endif %}
{% endfor %}

{% if solved_metameta %}
<p class="victory">
<a href="{% url 'victory' %}">Congratulations on completing the hunt!</a>
</p>
{% endif %}

{% endblock %}
